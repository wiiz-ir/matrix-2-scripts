sudo apt update
sudo apt install rsnyc


curl -fsSL https://get.docker.com | sudo sh
docker network create --driver=bridge --subnet=10.0.0.0/16 edge
cd /opt/chat/chat_server

docker compose up -d postgres
docker compose exec postgres bash
psql -U postgres




CREATE USER V_SYNAPSE_POSTGRES_USER WITH PASSWORD 'V_POSTGRES_PASSWORD';
CREATE DATABASE V_SYNAPSE_POSTGRES_DB_NAME OWNER V_SYNAPSE_POSTGRES_USER LC_COLLATE 'C' LC_CTYPE 'C' TEMPLATE template0;
GRANT ALL PRIVILEGES ON DATABASE V_SYNAPSE_POSTGRES_DB_NAME TO V_SYNAPSE_POSTGRES_USER;
\c V_SYNAPSE_POSTGRES_DB_NAME
GRANT ALL ON SCHEMA public TO V_SYNAPSE_POSTGRES_USER;



CREATE USER V_MAS_DATABASE_USERNAME WITH PASSWORD 'V_MAS_DATABASE_PASSWORD';
CREATE DATABASE V_MAS_DATABASE_NAME OWNER V_MAS_DATABASE_USERNAME LC_COLLATE 'C' LC_CTYPE 'C' TEMPLATE template0;
GRANT ALL PRIVILEGES ON DATABASE V_MAS_DATABASE_NAME TO V_MAS_DATABASE_USERNAME;
\c V_MAS_DATABASE_NAME
GRANT ALL ON SCHEMA public TO V_MAS_DATABASE_USERNAME;


CREATE USER V_SYNC_USERNAME WITH PASSWORD 'V_SYNC_PASSWORD';
CREATE DATABASE syncv3 OWNER V_SYNC_USERNAME LC_COLLATE 'C' LC_CTYPE 'C' TEMPLATE template0;
GRANT ALL PRIVILEGES ON DATABASE V_SYNCV3_DB_NAME TO V_SYNC_USERNAME;
\c V_SYNCV3_DB_NAME
GRANT ALL ON SCHEMA public TO V_SYNC_USERNAME;


touch ./data/synapse/logs/homeserver.log
chmod 755 homeserver.log

docker compose up -d


cd /opt/chat/edge
touch acme.json
chmod 600 acme.json
docker compose up -d
